# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

steps:
- script: |
    wget --output-document="$(Build.StagingDirectory)/bazel" https://github.com/bazelbuild/bazelisk/releases/download/v1.10.1/bazelisk-linux-amd64
    echo "##vso[task.prependpath]$(Build.StagingDirectory)"
  displayName: Install Bazelisk
  workingDirectory: $(Build.StagingDirectory)
  target: manylinux

- script: |
    miniconda_path="miniconda3"
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh -b -p $miniconda_path
    eval "$($miniconda_path/bin/conda shell.bash hook)" 
    conda create --name build python=$(vars.pyVersionMajorDotMinor) -y
    activate_cmd="source $(Build.StagingDirectory)/$miniconda_path/bin/activate build"
    echo "##vso[task.setVariable variable=activateCommand;isOutput=true]$activate_cmd"
  displayName: Install Miniconda
  name: miniconda
  workingDirectory: $(Build.StagingDirectory)
  target: manylinux

- script: |
    sudo apt update
    sudo apt install clang
  displayName: Install Clang
  workingDirectory: $(Build.StagingDirectory)
  target: manylinux